use sycamore::prelude::*;

use crate::models::{
    dark_mode::DarkMode, is_editing_config::IsEditingConfig, is_saving_chatlog::IsSavingChatlog,
};

#[component(inline_props)]
pub fn ButtonBarComponent() -> View {
    let dark_mode = use_context::<DarkMode>();
    let toggle_dark_mode = move |_| {
        dark_mode.toggle();
    };

    let is_editing_config = use_context::<IsEditingConfig>();
    let is_saving_chatlog = use_context::<IsSavingChatlog>();

    let toggle_edit_config = move |_| {
        is_saving_chatlog.signal().set(false);
        is_editing_config.toggle();
    };

    let toggle_saving_chatlog = move |_| {
        is_editing_config.signal().set(false);
        is_saving_chatlog.toggle();
    };

    // Get the git hash from the environment variable
    let git_hash = env!("GIT_HASH");
    let git_branch = env!("GIT_BRANCH");
    let git_info_string = format!("[{}@{}]", git_branch, git_hash);

    let button_fill_color = create_signal(if dark_mode.signal().get() {
        "var(--color-primary-text-dark)".to_string()
    } else {
        "var(--color-primary-text-dark)".to_string()
    });

    create_effect({
        let dark_mode_signal = dark_mode.signal();
        let button_fill_color = button_fill_color.clone();
        move || {
            button_fill_color.set(if dark_mode_signal.get() {
                "var(--color-primary-text-dark)".to_string()
            } else {
               "var(--color-primary-text)".to_string()
            });
        }
    });

    view! {
        div (class="button-bar") {
            div {
                div (class="text-logo") { a(href="https://github.com/tbogdala/switchboard/") {"Switchboard!" } }
                div (class="git-hash") { (git_info_string) }
            }

            div (class="button-group") {
                button(on:click = toggle_saving_chatlog, class="config-button", title="Save and load chatlogs") {
                    // NOTE: sourced from lineicons.com free-icons for box-archive-1
                    svg(width="18", height="18", viewBox="0 0 24 25", fill="none", xmlns="http://www.w3.org/2000/svg", transform="rotate(0 0 0)") {
                        path (d="M10 11.5645C9.58579 11.5645 9.25 11.9002 9.25 12.3145C9.25 12.7287 9.58579 13.0645 10 13.0645H14C14.4142 13.0645 14.75 12.7287 14.75 12.3145C14.75 11.9002 14.4142 11.5645 14 11.5645H10Z", fill=button_fill_color.get_clone())
                        path (fill-rule="evenodd", clip-rule="evenodd", d="M2 6.06445C2 4.82181 3.00736 3.81445 4.25 3.81445H19.75C20.9926 3.81445 22 4.82181 22 6.06445V7.06445C22 7.94788 21.4909 8.7124 20.75 9.08057V19.0645C20.75 20.3071 19.7426 21.3145 18.5 21.3145H5.5C4.25736 21.3145 3.25 20.3071 3.25 19.0645V9.08057C2.50914 8.7124 2 7.94788 2 7.06445V6.06445ZM4.75 9.31445H19.25V19.0645C19.25 19.4787 18.9142 19.8145 18.5 19.8145H5.5C5.08579 19.8145 4.75 19.4787 4.75 19.0645V9.31445ZM20.5 7.06445C20.5 7.47867 20.1642 7.81445 19.75 7.81445H4.25C3.83579 7.81445 3.5 7.47867 3.5 7.06445V6.06445C3.5 5.65024 3.83579 5.31445 4.25 5.31445H19.75C20.1642 5.31445 20.5 5.65024 20.5 6.06445V7.06445Z", fill=button_fill_color.get_clone())
                    }
                }

                button(on:click = toggle_dark_mode, class="config-button", title="Toggle dark mode") {
                    // NOTE: sourced from lineicons.com free-icons for bulb-4
                    svg(width="18", height="18", viewBox="0 0 25 24", fill="none", xmlns="http://www.w3.org/2000/svg", transform="rotate(0 0 0)") {
                        path(fill-rule="evenodd", clip-rule="evenodd", d="M9.0625 18.0453C9.01679 16.914 8.26885 15.8509 7.26013 14.8658C5.86655 13.5048 5 11.6029 5 9.49987C5 5.35781 8.35781 2 12.4999 2C16.6419 2 19.9997 5.35781 19.9997 9.49987C19.9997 11.6027 19.1333 13.5046 17.7399 14.8655C16.6988 15.8824 15.9355 16.9822 15.9355 18.1544V19.75C15.9355 20.9926 14.9282 22 13.6855 22H11.3125C10.0699 22 9.0625 20.9926 9.0625 19.75V18.0453ZM6.5 9.49987C6.5 6.18624 9.18624 3.5 12.4999 3.5C15.8135 3.5 18.4997 6.18624 18.4997 9.49987C18.4997 11.1824 17.8082 12.7021 16.6918 13.7925C15.9506 14.5164 15.1802 15.4257 14.7589 16.5H10.2412C9.81983 15.4258 9.04933 14.5165 8.30817 13.7927C7.19168 12.7023 6.5 11.1825 6.5 9.49987ZM10.5625 18.2129C10.564 18.1938 10.5647 18.1744 10.5647 18.1549C10.5647 18.1088 10.564 18.063 10.5625 18.0175V18H14.4355V19.75C14.4355 20.1642 14.0998 20.5 13.6855 20.5H11.3125C10.8983 20.5 10.5625 20.1642 10.5625 19.75V18.2129Z", fill=button_fill_color.get_clone())
                        path(d="M1.75 9.5C1.75 9.08579 2.08579 8.75 2.5 8.75H3.5C3.91421 8.75 4.25 9.08579 4.25 9.5C4.25 9.91421 3.91421 10.25 3.5 10.25H2.5C2.08579 10.25 1.75 9.91421 1.75 9.5Z", fill=button_fill_color.get_clone())
                        path(d="M4.21484 3.85048C3.85612 3.64337 3.39743 3.76628 3.19032 4.125C2.98322 4.48372 3.10612 4.94241 3.46484 5.14952L4.33087 5.64952C4.68959 5.85663 5.14828 5.73372 5.35539 5.375C5.56249 5.01628 5.43959 4.55759 5.08087 4.35048L4.21484 3.85048Z", fill=button_fill_color.get_clone())
                        path(d="M3.19032 14.875C2.98322 14.5163 3.10612 14.0576 3.46484 13.8505L4.33087 13.3505C4.68959 13.1434 5.14828 13.2663 5.35539 13.625C5.56249 13.9837 5.43959 14.4424 5.08087 14.6495L4.21484 15.1495C3.85612 15.3566 3.39743 15.2337 3.19032 14.875Z", fill=button_fill_color.get_clone())
                        path(d="M21.5 8.75C21.0858 8.75 20.75 9.08579 20.75 9.5C20.75 9.91421 21.0858 10.25 21.5 10.25H22.5C22.9142 10.25 23.25 9.91421 23.25 9.5C23.25 9.08579 22.9142 8.75 22.5 8.75H21.5Z", fill=button_fill_color.get_clone())
                        path(d="M19.6454 13.625C19.8525 13.2663 20.3112 13.1434 20.6699 13.3505L21.5359 13.8505C21.8947 14.0576 22.0176 14.5163 21.8105 14.875C21.6034 15.2337 21.1447 15.3566 20.7859 15.1495L19.9199 14.6495C19.5612 14.4424 19.4383 13.9837 19.6454 13.625Z", fill=button_fill_color.get_clone())
                        path(d="M19.9199 4.35048C19.5612 4.55759 19.4383 5.01628 19.6454 5.375C19.8525 5.73372 20.3112 5.85663 20.6699 5.64952L21.5359 5.14952C21.8947 4.94241 22.0176 4.48372 21.8105 4.125C21.6034 3.76628 21.1447 3.64337 20.7859 3.85048L19.9199 4.35048Z", fill=button_fill_color.get_clone())
                    }
                }

                button(on:click = toggle_edit_config, class="config-button", title="Edit configuration settins") {
                // NOTE: sourced from lineicons.com free-icons for gears-3
                    svg(width="18", height="18", viewBox="0 0 24 25", fill="none", xmlns="http://www.w3.org/2000/svg", transform="rotate(0 0 0)") {
                        path(d="M4.25315 5.39728C5.24418 5.9627 6.47801 5.25034 6.48385 4.10938L7.98373 4.10938C7.98956 5.25038 9.22343 5.96275 10.2145 5.3973L10.9635 6.6946C11.3812 6.46162 11.8798 6.30786 12.3876 6.21697C12.3568 6.12702 12.3169 6.03871 12.2675 5.95326L11.5095 4.64028C11.0998 3.93076 10.1954 3.68503 9.48364 4.0873C9.47615 3.26978 8.81111 2.60938 7.99183 2.60938H6.47573C5.65647 2.60938 4.99145 3.26976 4.98393 4.08724C4.27222 3.68501 3.3678 3.93074 2.95817 4.64024L2.20012 5.95323C1.79048 6.66275 2.0299 7.56889 2.73413 7.98413C2.0299 8.39938 1.7905 9.30551 2.20013 10.015L2.95819 11.328C3.36782 12.0375 4.27222 12.2832 4.98394 11.881C4.98962 12.4994 5.37154 13.0279 5.91185 13.2486C5.909 12.6779 6.05286 12.0988 6.35883 11.5689L6.4266 11.4515C6.17233 10.5593 5.11989 10.0765 4.25316 10.571L3.50323 9.27204C4.48844 8.69649 4.48842 7.27175 3.50321 6.69621L4.25315 5.39728Z", fill=button_fill_color.get_clone())
                        path(d="M7.23401 9.48438C8.06244 9.48438 8.73401 8.8128 8.73401 7.98438C8.73401 7.15595 8.06244 6.48438 7.23401 6.48438C6.40558 6.48438 5.73401 7.15595 5.73401 7.98438C5.73401 8.8128 6.40558 9.48438 7.23401 9.48438Z", fill=button_fill_color.get_clone())
                        path(fill-rule="evenodd", clip-rule="evenodd", d="M11.6406 15.1107C11.6406 13.418 13.0129 12.0457 14.7056 12.0457C16.3984 12.0457 17.7706 13.418 17.7706 15.1107C17.7706 16.8035 16.3984 18.1757 14.7056 18.1757C13.0129 18.1757 11.6406 16.8035 11.6406 15.1107ZM14.7056 13.5457C13.8413 13.5457 13.1406 14.2464 13.1406 15.1107C13.1406 15.975 13.8413 16.6757 14.7056 16.6757C15.57 16.6757 16.2706 15.975 16.2706 15.1107C16.2706 14.2464 15.57 13.5457 14.7056 13.5457Z", fill=button_fill_color.get_clone())
                        path(fill-rule="evenodd", clip-rule="evenodd", d="M7.65797 17.9026C7.15164 17.0256 7.45257 15.9045 8.32916 15.3984C8.55144 15.27 8.55094 14.9496 8.32953 14.8218C7.45293 14.3157 7.15258 13.1948 7.65869 12.3182L8.76495 10.4021C9.27102 9.52553 10.3919 9.22535 11.2683 9.73135C11.49 9.85937 11.767 9.69928 11.767 9.44355C11.767 8.43154 12.5874 7.61115 13.5994 7.61115H15.8121C16.8245 7.61115 17.6448 8.43199 17.6448 9.44397C17.6448 9.7002 17.9221 9.85987 18.1434 9.73212C19.0198 9.22613 20.1404 9.52641 20.6464 10.4028L21.7531 12.3196C22.259 13.1959 21.9588 14.3164 21.0825 14.8223C20.8615 14.9499 20.861 15.2697 21.0829 15.3978C21.9591 15.9037 22.26 17.0245 21.7538 17.9012L20.6475 19.8173C20.1414 20.6939 19.0205 20.9942 18.1439 20.4881C17.9222 20.3601 17.6448 20.5201 17.6448 20.7764C17.6448 21.7886 16.8243 22.6094 15.8119 22.6094H13.5996C12.5875 22.6094 11.767 21.7889 11.767 20.7768C11.767 20.5211 11.4899 20.3606 11.2678 20.4888C10.3913 20.9949 9.27006 20.6948 8.76384 19.818L7.65797 17.9026ZM9.07916 16.6974C8.91962 16.7895 8.86512 16.9935 8.957 17.1526L10.0629 19.068C10.1547 19.2271 10.3584 19.2818 10.5178 19.1898C11.7392 18.4846 13.267 19.3656 13.267 20.7768C13.267 20.9605 13.4159 21.1094 13.5996 21.1094H15.8119C15.9957 21.1094 16.1448 20.9603 16.1448 20.7764C16.1448 19.3657 17.672 18.4836 18.8939 19.1891C19.0531 19.281 19.2566 19.2264 19.3485 19.0673L20.4548 17.1512C20.5465 16.9923 20.4921 16.7888 20.3329 16.6968C19.1119 15.9919 19.1106 14.2287 20.3325 13.5233C20.4913 13.4316 20.5458 13.2285 20.4541 13.0696L19.3474 11.1528C19.2556 10.9938 19.0523 10.9394 18.8934 11.0312C17.6715 11.7366 16.1448 10.8542 16.1448 9.44397C16.1448 9.2601 15.9957 9.11114 15.8121 9.11114L13.5994 9.11115C13.4158 9.11115 13.267 9.25997 13.267 9.44355C13.267 10.8543 11.7397 11.7356 10.5183 11.0304C10.3592 10.9385 10.1558 10.9931 10.064 11.1521L8.95773 13.0682C8.86583 13.2273 8.92037 13.4308 9.07953 13.5227C10.3018 14.2284 10.3006 15.9922 9.07916 16.6974Z", fill=button_fill_color.get_clone())
                    }

                }
            }
        }
    }
}
